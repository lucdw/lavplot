\name{lavplot}
\alias{lavplot}
\alias{lav_plot}
\title{Creates diagram code for tikz, svg or creates an Rplot}
\usage{
lavplot(model = NULL,
        infile = NULL,
        varlv = FALSE,
        placenodes = NULL,
        edgelabelsbelow = NULL,
        group.covar.indicators = FALSE,
        common.opts = list(sloped.labels = TRUE,
                           mlovcolors = c("lightgreen", "lightblue"),
                           italic = TRUE,
                           lightness = 1),
        rplot = list(outfile = "",
                     addgrid = TRUE),
        tikz = list(outfile = "",
                    cex = 1.3,
                    standalone = FALSE),
        svg = list(outfile = "",
                   stroke.width = 2L,
                   font.size = 20L,
                   idx.font.size = 15L,
                   dy = 5L,
                   font.family = "Latin Modern Math, arial, Aerial, sans",
                   standalone = FALSE)
        )
lav_plot(model = NULL,
        infile = NULL,
        varlv = FALSE,
        placenodes = NULL,
        edgelabelsbelow = NULL,
        group.covar.indicators = FALSE,
        common.opts = list(sloped.labels = TRUE,
                           mlovcolors = c("lightgreen", "lightblue"),
                           italic = TRUE,
                           lightness = 1),
        rplot = list(outfile = "",
                     addgrid = TRUE),
        tikz = list(outfile = "",
                    cex = 1.3,
                    standalone = FALSE),
        svg = list(outfile = "",
                   stroke.width = 2L,
                   font.size = 20L,
                   idx.font.size = 15L,
                   dy = 5L,
                   font.family = "Latin Modern Math, arial, Aerial, sans",
                   standalone = FALSE)
        )
}
\arguments{
\item{model}{A character vector specifying the model in lavaan syntax or a list
(or data.frame) with at least members lhs, op, rhs, label and fixed or a fitted
lavaan object (in which case the \code{ParTable} object is extracted and column
\code{est} is used as value to show).
Should be \code{NULL} if infile is given.}
\item{infile}{A character string specifying the file which contains the model
syntax.}
\item{varlv}{A logical indicating that the (residual) variance of a variable
should be plotted as a separate latent variable (with a smaller circle then
ordinary latent variables). In this case covariances between two such variables
will be plotted as covariance between the latent variables for the variance.}
\item{placenodes}{optional list with members \code{\var{nodename} = c(row, column)},
\code{row} and \code{column} don't have to be integers.}
\item{edgelabelsbelow}{optional list with members \code{c(\var{nodename1},
\var{nodename2})}.}
\item{group.covar.indicators}{logical, should items with indicators which
have an explicit covariance link be placed in the same group, i.e. forced
to be on the same side of the diagram?}
\item{common.opts}{options common to the three types of generated plots.}
\item{rplot}{options for creating Rplot,
see \code{\link{lav_make_rplot}}.}
\item{tikz}{options for creating code for tikz plot,
see \code{\link{lav_make_tikz}}.}
\item{svg}{options for creating code for svg plot,
see \code{\link{lav_make_svg}}.}
}
\details{
If \code{rplot} is specified or neither \code{tikz} nor \code{svg} are specified
an R plot is generated, possibly stored in a png file if the outfile member of
\code{rplot} is set. If \code{tikz} is specified the code for a tikz diagram is
stored in the specified \code{outfile}, and the same for svg.

The lavplot command tries to create a nice plot from the input model, but
one should keep the names of the variables short and sometimes rearrange the
nodes in the plot. As an example the (slightly modified) example of the
\code{sem} function in \code{lavaan} results in the following first plot
hereunder. If we use the placenodes argument, we get the second plot.
\if{html}{\figure{semex0.svg}{options: width=500 alt="sem example"}}
\if{latex}{\figure{semex0.pdf}{options: width=3in}}
\if{html}{\figure{semex.svg}{options: width=500 alt="sem example"}}
\if{latex}{\figure{semex.pdf}{options: width=3in}}

More details on the parameters can be found in the help for
the \code{lav_\dots} functions.
}
\value{
NULL, invisible
}
\description{
\if{html}{\figure{logo.svg}{options: width=60 alt="lavplot logo"}}
\if{latex}{\figure{logo.pdf}{options: width=0.5in}}
Creates code to make a diagram in tikz or svg or plot the diagram or store
the diagram in a png file.
}
\seealso{
\code{\link{lav_get_model_info}}, \code{\link{lav_position_nodes}},
\code{\link{lav_make_rplot}}, \code{\link{lav_make_tikz}},
\code{\link{lav_make_svg}}
}
\examples{
model <- 'alpha_11  =~ 1 * x_1 + x_2 + x_3     # latent variable
          alpha_12 <~ x_4 + x_5 + x_6          # composite
          gamma =~ 1 * x_7 + x_8 + x_9         # latent variable
          xi =~ 1 * x_10 + x_11 + x_12 + x_13  # latent variable
          x_1 ~~ x_3
          x_2 ~~ epsilon_2 * x_2
          x_12 ~~ epsilon_12 * x_12
          x_4 ~~ epsilon_4 * x_4
          x_7 ~~ x_9
          x_10 ~~ x_11 + x_13
          gamma ~~ 0.7 * xi
          # regressions
          xi ~ v * alpha_11 + t * alpha_12 + 1
          alpha_11 ~ yy * Theta_1 + tt_1 * 0.12 * alpha_12 + ss * gamma
          Theta_1 ~~ alpha_12
          '
lavplot(model)
lavplot(model,
        placenodes=list(Theta_1 = c(2, 2.5)),
        tikz = list(outfile=stdout()))
modelml <- '
        level: 1
        fw =~ y_1 + y_2 + y_3 + y_4
        level: 2
        fb =~ y_1 + y_2 + y_3 + y_5
        y_2 ~~ cv24 * y_5
  '
tikzcodeml <- lavplot(modelml,
              svg = list(outfile=stdout())
              )

\dontrun{
# example creating tex file with the above models
zz <- file("testtikz.tex", open="w")
writeLines(c(
  '\\documentclass{article}',
  '\\usepackage{amsmath, amssymb}',
  '\\usepackage{amsfonts}',
  '\\usepackage[utf8]{inputenc}',
  '\\usepackage[english]{babel}',
  '\\usepackage{xcolor}',
  '\\usepackage{color}',
  '\\usepackage{tikz}',
  '\\usetikzlibrary {shapes.geometric}',
  '\\begin{document}'),
  zz)
lavplot(model,
        tikz = list(outfile = "tmp.tex")
        )
tmp <- readLines("tmp.tex")
writeLines(tmp, zz)
writeLines(" ", zz)
lavplot(modelml,
        common.opts = list(sloped.labels = FALSE,
                           mlovcolors = c("lightgreen", "lightblue")),
        tikz = list(outfile = "tmp.tex", cex = 1.4)
        )
tmp <- readLines("tmp.tex")
writeLines(tmp, zz)
writeLines("\\end{document}", zz)
close(zz)
openPDF <- function(f) {
  os <- .Platform$OS.type
  if (os=="windows")
    shell.exec(normalizePath(f))
  else {
    pdf <- getOption("pdfviewer", default='')
    if (nchar(pdf)==0)
      stop("The 'pdfviewer' option is not set. Use options(pdfviewer=...)")
    system2(pdf, args=c(f))
  }
}
tools::texi2dvi("testtikz.tex", pdf = TRUE, clean = TRUE)
openPDF("testtikz.pdf")

# example creating html file with the above diagrams
zz <- file("demosvg.html", open="w")
writeLines(c(
  '<!DOCTYPE html>',
  '<html>',
  '<body>',
  '<h2>SVG diagrams created by lavplot R package</h2>'),
  zz)
lavplot(model,
        svg =  list(outfile = "temp.svg")
        )
tmp <- readLines("tmp.svg")
writeLines(tmp, zz)
writeLines("<br />", zz)
lavplot(modelml,
        common.opts = list(sloped.labels = FALSE),
        tikz = list(outfile = "tmp.svg")
        )
tmp <- readLines("tmp.svg")
writeLines(tmp, zz)
writeLines(c("</body>", "</html>"), zz)
close(zz)
browseURL("demosvg.html")
}
}
